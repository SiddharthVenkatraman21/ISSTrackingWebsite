<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISS Tracking on CesiumJS Globe</title>
    <link rel="stylesheet" href="https://cesium.com/downloads/cesiumjs/releases/1.91/Build/Cesium/Widgets/widgets.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #cesiumContainer {
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="cesiumContainer"></div>

    <script src="https://cesium.com/downloads/cesiumjs/releases/1.91/Build/Cesium/Cesium.js"></script>
    <script>
        // Replace 'YOUR_CESIUM_ION_ACCESS_TOKEN' with your actual Cesium ion access token
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzYzNjOThlZi1hNDQ2LTQxYzktOGMxNS0wZjA0NWUxOWEyZjUiLCJpZCI6MTg4MjM4LCJpYXQiOjE3MDQ1ODEyMjl9.ek7OBolIDh1ziOVl9kotU9oOo1-Pv35AlK5YFiTmxqg';

        var viewer = new Cesium.Viewer('cesiumContainer', {
            baseLayerPicker: false,
            animation: false,
            timeline: false ,
            geocoder: false,
        });

        var issEntity = viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(0, 0),
            billboard: {
                image: 'ISS_spacecraft_model_1.png',  // Replace with the correct path to your ISS icon
                width: 50,
                height: 50
            },
            // Add a transparent radius (in meters) around the ISS icon
            ellipse: {
                semiMinorAxis: 800000,  // Adjust the radius as needed
                semiMajorAxis: 800000,
                material: Cesium.Color.fromCssColorString('rgba(50,50,50,0.7)')  // Adjust the alpha value (transparency) as needed
            }
        });

        // Function to update ISS position
        function moveISS() {
            fetch('http://localhost:3000/api/iss-position')
                .then(response => response.json())
                .then(data => {
                    var lat = parseFloat(data.iss_position.latitude);
                    var lon = parseFloat(data.iss_position.longitude);

                    // Update the ISS position in Cesium
                    issEntity.position.setValue(Cesium.Cartesian3.fromDegrees(lon, lat));
                })
                .catch(error => console.error('Error fetching ISS data:', error));

            setTimeout(moveISS, 5000);
        }

        // Initial call to start ISS tracking
        moveISS();
    </script>
</body>
</html>
